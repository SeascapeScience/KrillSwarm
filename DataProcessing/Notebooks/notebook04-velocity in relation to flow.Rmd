---
title: "Velocity in relation to flow"
output: html_notebook
---


```{r}
rm(list=ls(all=TRUE))
load("C:\\Users\\Nicole Hellessey\\Documents\\Post-doc\\Data\\Total Merged Data File (Dec 6 2021).Rdata")


## Flow happens in the Y direction

## So, vy - flow = vel.flow (velocity in relation to flow)


## Need to make flow rate numeric first
str(TotalData)
TotalData$Flow.rate <- as.character(TotalData$Flow.rate)
TotalData$Flow.rate <- as.numeric(TotalData$Flow.rate)

head(TotalData) ## all TotalData rows
str(TotalData)
TotalData$vel.flow <- TotalData$vy-TotalData$Flow.rate
TotalData$Flow.rate <- as.factor(TotalData$Flow.rate)


##remake complete cases dataframe with vel.flow included
CC.TotalData <- na.omit(TotalData)
head(CC.TotalData) ##only complete cases of TotalData 
str(CC.TotalData)


## Basic plot of vy vs Flow Rate
plot(CC.TotalData$Flow.rate, CC.TotalData$vy, xlab = "Flow Rate (cm/s)", ylab = "Velocity in Y direction (vy, cm/s)")
## Basic plot of vel.flow vs Flow Rate (should be different to above)
plot(CC.TotalData$Flow.rate, CC.TotalData$vel.flow, xlab = "Flow Rate (cm/s)", ylab = "Velocity in Y direction minus flow (vel.flow, cm/s)")


## Plotting turn angles in relation to swim velocity (accounting for flow rate)
for (i in 1:length(ind)){
plot(CC.TotalData$turn.angle[CC.TotalData$D_V_T==ind[i]], CC.TotalData$vel.flow[CC.TotalData$D_V_T==ind[i]],
            xlab = "Turn Angles",
     ylab = "Velocity in relation to flow (cm/s)",
          main = ind[i]) 
}

library(ggplot2)

## plot Flow Rate by Vel.flow filled by Chla faceted by light
ggplot(CC.TotalData,aes(x=Flow.rate, y=vel.flow, fill=Chlorophyll))+
  geom_boxplot(notch=F, notchwidth=0.3,outlier.shape=1,outlier.size=2, coef=1.5)+
  theme(axis.text=element_text(color="black"))+
  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.4))+
  theme(panel.grid.minor=element_blank())+
  labs(size= "",x = "Flow Rate (cm/s)", y = "Velocity in relation to flow (cm/s)", title = "Light") +
  scale_fill_manual(values=c("greenyellow", "yellowgreen","lightgreen", "green", "green3", "green4", "darkgreen"),name = "Chlorophyll (mg/L)",
                    labels=c("0", "4.3", "4.6", "6.1", "7.6", "13.5", "19"))+
  facet_grid(~Light, scales = "free_x", space = "free")

## plot Chlorophyll by vel.flow filled by flow rate faceted by light
ggplot(CC.TotalData,aes(x=Chlorophyll, y=vel.flow, fill=Flow.rate))+
  geom_boxplot(notch=F, notchwidth=0.3,outlier.shape=1,outlier.size=2, coef=1.5)+
  theme(axis.text=element_text(color="black"))+
  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.4))+
  theme(panel.grid.minor=element_blank())+
  labs(size= "",x = "Chlorophyll (mg/L)", y = "Velocity in realtion to flow (cm/s)", title = "Light") +
  scale_fill_manual(values=c("white", "beige", "yellow", "orange", "red"), name = "Flow Rate (cm/s)",
                    labels=c("0", "0.6", "3", "5.9", "8"))+
  facet_grid(~Light, scales = "free_x", space = "free")

## plot Chlorophyll by turn angle filled by flow rate facted by light
ggplot(CC.TotalData,aes(x=Chlorophyll, y=turn.angle, fill=Flow.rate))+
  geom_boxplot(notch=F, notchwidth=0.3,outlier.shape=1,outlier.size=2, coef=1.5)+
  theme(axis.text=element_text(color="black"))+
  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.4))+
  theme(panel.grid.minor=element_blank())+
  labs(size= "",x = "Chlorophyll (mg/L)", y = "Turn angle (degrees)", title = "Light") +
  scale_fill_manual(values=c("white", "beige", "yellow", "orange", "red"), name = "Flow Rate (cm/s)",
                    labels=c("0", "0.6", "3", "5.9", "8"))+
  facet_grid(~Light, scales = "free_x", space = "free")

## plot turn angle by vel.flow filled by chla, faceted by flow rate
ggplot(CC.TotalData,aes(x=turn.angle, y=vel.flow))+
  geom_point(aes(colour=Chlorophyll))+
  facet_grid(~Flow.rate, scales = "free_x", space = "free")+
  labs(size= "",x = "Turn angle (degrees)", y = "Velocity in relation to flow (cm/s)", title = "Flow Rate (cm/s)")+
  theme(axis.text=element_text(color="black"))+
  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.4))+
  theme(panel.grid.minor=element_blank())+
  scale_colour_manual(values=c("greenyellow", "yellowgreen","lightgreen", "green", "green3", "green4", "darkgreen"),name = "Chlorophyll (mg/L)", labels=c("0", "4.3", "4.6", "6.1", "7.6", "13.5", "19"))
 
```


